<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Liam Israel | [Personal Site]</title>
    <link rel="stylesheet" href="styles.css" />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <!-- Markdown to HTML conversion-->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Syntax highlighting -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/paraiso-dark.min.css"
    />
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/go.min.js"></script>
  </head>

  <body>
    <!-- Hero element -->
    <div class="hero" style="display: none;">
      <h3>[Personal Site]</h3>
      <p>A place to share and share.</p>
    </div>
    <!-- Navbar -->
    <nav class="navbar">
      <div class="vertical-line"></div>
      <a href="?page=home">Home</a>
      <div class="vertical-line"></div>
      <a href="?page=articles">Articles</a>
      <div class="vertical-line"></div>
      <a href="?page=about_me">About Me</a>
      <div class="vertical-line"></div>
    </nav>
    <!-- Main part of page -->
    <div class="main-document">
      <div class="content" id="content">
        <!--Article will go here-->
      </div>
      <!-- List of articles and featured ones go here-->
      <div id="list-mask" style="display: none">
        <div class="article-list">
          <h2 class="selection-list-header">
            Featured &#x1F31F;:
            <hr />
          </h2>
          <!-- Featured items go here -->
          <ol id="featured-list" class="selection-list"></ol>
          <h2 class="selection-list-header">
            All &#x1F4DA;:
            <hr />
          </h2>
          <!-- Featured items go here -->
          <ul id="regular-select-list" class="selection-list"></ul>
        </div>
      </div>
    </div>
    <footer>
      <!--Footer cards-->
      <div class="footer-cards">
        <div>
          <i class="fab fa-github"></i>
          Find Larmbs on
          <a target="_blank" class="custom-link" id="github">GitHub</a>
        </div>
        <div>
          <i class="fab fa-linkedin"></i>
          Find me on
          <a target="_blank" class="custom-link" id="linkedin">Linkedin</a>
        </div>
        <div>
          <i class="fas fa-envelope"></i>
          Email me at
          <a target="_blank" class="custom-link" id="email"></a>
        </div>
      </div>
      <hr />
      <p>Copyright &copy; 2024 <em id="name"></em>. All rights reserved.</p>
    </footer>

    <script type="module">
      // Adding profile data in
      fetch("assets/profile.json")
        .then((r) => r.json())
        .then((profile_json) => {
          document.getElementById("name").innerHTML = profile_json.name;
          document.getElementById("email").innerHTML = profile_json.email;
          document.getElementById(
            "email"
          ).href = `mailto: ${profile_json.email}`;
          document.getElementById("linkedin").href = profile_json.linkedin;
          document.getElementById("github").href = profile_json.github;
        })
        .catch((e) => {
          console.error("Could not load profile directory");
        });

      // Getting URL params and determining what to load
      const urlParams = new URLSearchParams(window.location.search);
      const page = urlParams.get("page");

      let markdown = await fetch("assets/pages.json")
        .then((r) => r.json())
        .then((articles_json) => {
          return articles_json;
        })
        .catch((e) => {
          console.error("Failed to load article directory");
        });

      // Handling cases
      if (page === null || page === "home") {
        load_content(markdown.home.src);
      } else if (page === "about_me") {
        load_content(markdown.about_me.src);
      } else if (page == "articles") {
        const article_name = urlParams.get("article");
        if (article_name == null) {
          load_content(markdown.article_select.src);
          populate_selection_list(markdown);
        } else {
          load_content(markdown.articles[article_name].src);
        }
      }

      // Loads content from some URL
      function load_content(url) {
        fetch(url)
          .then((r) => r.text())
          .then((text) => {
            document.getElementById("content").innerHTML = marked.parse(text);
            // Updating syntax highlighting
            hljs.highlightAll();
          });
      }

      // Fills up select felids in selection lists
      function populate_selection_list(markdown) {
        document.getElementById("list-mask").style = "display: block";

        const featured_list = document.getElementById("featured-list");
        const regular_select_list = document.getElementById(
          "regular-select-list"
        );
        markdown.featured.forEach((name) => {
          featured_list.appendChild(create_item(name, markdown.articles[name]));
        });

        Object.entries(markdown.articles).forEach(([name, data]) => {
          
          regular_select_list.appendChild(create_item(name, data));
        });

        function create_item(name, data) {
          // Creating selection box tag
          const tag = document.createElement("span");
          tag.className = "tag";
          tag.innerHTML = data.type;

          // Creating selection box date
          const date = document.createElement("span");
          date.className = "date";
          date.innerHTML = `~${data.time_added}~`;

          // Putting it into a meta element
          const meta_data = document.createElement("div");
          meta_data.appendChild(tag);
          meta_data.appendChild(date);

          // Adding a hr element
          const hr = document.createElement("hr");

          // Creating a content box
          const content = document.createElement("h4");
          content.innerHTML = name;

          // Putting it all into a list item, clickable
          const li = document.createElement("li");
          li.appendChild(meta_data);
          li.appendChild(hr);
          li.appendChild(content);
          li.setAttribute(
            "onclick",
            `window.location.href = '?page=articles&article=${name}';`
          );
          return li;
        }
      }
    </script>
  </body>
</html>
